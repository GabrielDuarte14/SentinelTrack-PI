<!DOCTYPE html>
<html lang="pt-br">
<style>
    #bolinha {
        height: 20px;
        width: 20px;
        background-color: red;
        cursor: pointer;
        border-radius: 100%;
    }
</style>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="shortcut icon" href="./assets/icon/Logo_Temporaria.png" />
    <link rel="stylesheet" href="estilo.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/funcoes.js"></script>

</head>

<body onload="dadosUsuario()">

    <div class="dash">
        <div class="fold">
            <div class="titulo_nav">
                <img src="assets/icon/Logo_Temporaria.png" height="50px">
                <h3 class="texts">Configurações</h3>
            </div>
            <div class="usuario_nav">
                <span class="texts" id="b_usuario"></span>
            </div>
            <div class="botoes_nav">
                <a href="usuario.html">
                    <button class="botao" id="botaoselecionado">
                        Usuário
                    </button>
                </a>
                <a href="empresa.html" id="empresaA">
                    <button class="botao" >
                        Empresa
                    </button>
                </a>
                <a href="funcionario.html" id="funcionarioA">
                    <button class="botao">
                        Funcionarios
                    </button>
                </a>
            </div>
            <div class="opcoes_nav">
                <a href="dashboard.html">Dashboard</a>
                <a href="index.html">Sair</a>
            </div>
        </div>

        <div class="corpo_config">
            <h1>Meu Usuário:</h1>

            <table class="tab_info">
                <tr>
                    <td>Nome:</td>
                    <td><input type="text" id="nomeUsuario" value="nome"></td>
                </tr>
                <tr>
                    <td>Sobrenome:</td>
                    <td><input type="text"  id="sobrenomeUsuario" value="sorenome"></td>
                </tr>
                <tr>
                    <td>Cargo:</td>
                    <td><input type="text" id="cargoUsuario" value="administrador"></td>
                </tr>
                <tr>
                    <td>Usuário:</td>
                    <td><input type="text" id="usuario" value="usuario"></td>
                </tr>
                
                <tr>
                    <td>Nova Senha:</td>
                    <td class="senha">
                        <input  type="password" id="nova_senha">
                        <button onclick="mostrarSenha(2)"><img id="i2" src="imagens/olho_d.png" height="30px"></button>
                    </td>
                </tr>
                <tr>
                    <td>Confirmar Senha:</td>
                    <td class="senha">
                        <input id="b3" type="password" id="confirmar_senha">
                        <button onclick="mostrarSenha(3)"><img id="i3" src="imagens/olho_d.png" height="30px"></button>
                    </td>
                </tr>
            </table>

            <div class="botao_config">
               <button onclick="salvarAlteracoes()">Salvar Alterações</button>
            </div>
        </div>

    </div>
</body>

</html>

<script>
    function salvarAlteracoes(){

        fetch("/usuarios/alterar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nomeServer: nomeUsuario.value,
                sobrenomeServer: sobrenomeUsuario.value,
                cargoServer: cargoUsuario.value,
                emailServer: usuario.value,
                senhaServer: nova_senha.value
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO alterar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;

                    setTimeout(function () {
                        window.location = "./dashboard/cards.html";
                    }, 1000); // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function mostrarSenha(campo) {

        if (campo == 1) {

            if (b1.type == 'password') {

                b1.type = 'text';
                i1.src = 'imagens/olho_a.png';
            } else {

                b1.type = 'password';
                i1.src = 'imagens/olho_d.png';
            }
        } else if (campo == 2) {

            if (b2.type == 'password') {

                b2.type = 'text';
                i2.src = 'imagens/olho_a.png';
            } else {

                b2.type = 'password';
                i2.src = 'imagens/olho_d.png';
            }
        } else if (campo == 3) {

            if (b3.type == 'password') {

                b3.type = 'text';
                i3.src = 'imagens/olho_a.png';
            } else {

                b3.type = 'password';
                i3.src = 'imagens/olho_d.png';
            }
        }
    }
</script>